<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ›ï¸ ETFæŒè‚¡åˆ†æå¹³å°</title>
  <style>
body{background:#f7f7fa;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;margin:0;}
.header{
  background:linear-gradient(120deg,#7964e7 0%,#53a0e2 100%);
  color:white;
  padding:36px 0 13px 0;
  text-align:center;
  margin-bottom:32px;
  font-weight:500;}
.header h1{margin:0;font-size:2.2rem;}
.header p{margin:13px 0 0 0;font-size:1.07rem;}
.update{color:#e3e5ea;font-size:1.08rem;font-weight:400;margin-top:7px;}
.etf-panel{background:#fff;border-radius:18px;max-width:980px;margin:0 auto 34px auto;box-shadow:0 2px 10px rgba(80,90,140,.09);padding:30px 32px 20px 32px;}
.etf-title{font-size:1.45rem;font-weight:520;display:flex;align-items:center;}
.etf-title .icon{font-size:1.7em;margin-right:8px;}
.etf-tabs{margin:23px 0 18px 0;border-bottom:2px solid #edeefa;display:flex;gap:40px;}
.etf-tab{font-size:1.18rem;color:#6d7dc7;padding-bottom:7px;margin-right:8px;cursor:pointer;border:none;background:none;border-bottom:2.5px solid transparent;transition:all .23s;}
.etf-tab.active{color:#7964e7;border-bottom:2.5px solid #7964e7;}
@media(max-width:760px){.etf-panel{padding:15px 8px}}
.etf-data-card{margin-top:16px;margin-bottom:24px;}
.etf-code{font-size:27px;font-weight:bold;color:#496ddd;margin-right:18px;}
.etf-name{font-size:17px;color:#555;font-weight:500;}
.etf-price{font-size:33px;font-weight:bold;color:#222;display:inline-block;margin-right:18px;}
.etf-change{font-size:18px;font-weight:500;display:inline-block;margin-left:2px;}
.etf-change.negative{color:#e74c3c;}
.etf-change.positive{color:#27ae60;}
.etf-date{font-size:15px;color:#666;margin-top:7px;}
.chip{font-size:14px;background:#f7f9fd;color:#5d65ae;padding:3px 10px;border-radius:12px;display:inline-block;margin-right:12px;}
.etf-table{border-collapse:collapse;width:100%;margin-top:14px;}
.etf-table th{background:#f5f7fa;color:#333;font-size:15px;font-weight:600;padding:11px 8px;border-bottom:2px solid #eee;}
.etf-table td{padding:13px 8px;font-size:16px;border-bottom:1px solid #eef0f2;}
.status-new{background:#d4edda;color:#155724;padding:3px 7px;border-radius:12px;font-size:13px;}
.status-add{background:#d1ecf1;color:#277095;padding:3px 7px;border-radius:12px;font-size:13px;}
.status-reduce{background:#f8d7da;color:#721c24;padding:3px 7px;border-radius:12px;font-size:13px;}
.positive{color:#27ae60;}
.negative{color:#e74c3c;}
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ›ï¸ ETFæŒè‚¡åˆ†æå¹³å° <span style="font-size:13px;font-weight:500;color:#dedafc;background:#7b70c6;border-radius:7px;padding:1.5px 9px;margin-left:8px;vertical-align:middle;">v2.0</span></h1>
    <p class="update" id="updateTime"></p>
    <p style="font-weight:400;margin-top:8px;">è³‡æ–™ä¾†æº: ç¾¤ç›Šã€é‡æ‘</p>
  </div>
  <div class="etf-panel">
    <div class="etf-title">
      <span class="icon">ğŸ“Š</span>
      ETF ä»Šæ—¥è®Šå‹•
    </div>
    <div class="etf-tabs" id="etfTabs"></div>
    <div id="etfDetailArea"></div>
  </div>
  <script>
    let processedData = {};
    let currentETF = null; // ç›®å‰é¸æ“‡ETFä»£ç¢¼

    // ä»Šæ—¥æ˜ç´°è¡¨ - æ¯å€‹ETFä¸€é 
    function renderEtfDetail(etfCode) {
      const data = processedData[etfCode];
      if (!data) { document.getElementById('etfDetailArea').innerHTML = '<div style="color:#999;">æš«ç„¡è³‡æ–™</div>'; return; }
      // ä¸»ETFå¡è³‡è¨Šï¼ˆæ¨™é¡Œã€åƒ¹æ ¼ã€æ¼²è·Œã€æœ€æ–°æ—¥æœŸï¼‰
      let html = `
        <div class="etf-data-card">
          <span class="etf-code">${etfCode}</span>
          <span class="etf-name">${data.name}</span><br>
          <span class="etf-price">$${data.price}</span>
          <span class="etf-change ${parseFloat(data.change_value)<0?'negative':'positive'}">
            ${parseFloat(data.change_value)>=0 ? 'â–²' : 'â–¼'} ${data.change_value} (${data.change_percent})
          </span>
          <div class="etf-date">æœ€æ–°æ›´æ–°æ—¥: ${data.latest_date}</div>
        </div>
        <div class="chip">æœ€æ–°ç•°å‹•è‚¡ç¥¨æ˜ç´°</div>
        <table class="etf-table"><thead>
          <tr>
            <th>ä»£ç¢¼</th>
            <th>åç¨±</th>
            <th>ä»Šæ—¥æŒè‚¡</th>
            <th>ä»Šæ—¥æ¬Šé‡</th>
            <th>å¼µæ•¸è®Šå‹•</th>
            <th>æ¬Šé‡è®Šå‹•</th>
            <th>ç‹€æ…‹</th>
          </tr>
        </thead><tbody>
      `;
      data.daily_changes.forEach(row=>{
        const statusClass = row.type=='æ–°å¢'?'status-new':row.type=='å¢æŒ'?'status-add':'status-reduce';
        const changeClass = row.count_change>0?'positive':row.count_change<0?'negative':'';
        html += `<tr>
          <td>${row.code}</td>
          <td>${row.name}</td>
          <td>${row.current_count.toLocaleString()}</td>
          <td>${row.current_weight}%</td>
          <td class="${changeClass}">${row.count_change>0?'+':''}${row.count_change.toLocaleString()}</td>
          <td class="${changeClass}">${row.weight_change>0?'+':''}${row.weight_change}</td>
          <td><span class="${statusClass}">${row.type}</span></td>
        </tr>`;
      });
      html += "</tbody></table>";
      document.getElementById('etfDetailArea').innerHTML = html;
    }

    function renderTabs() {
      const keys = Object.keys(processedData);
      let tabHtml = "";
      keys.forEach((etf,i)=>{
        tabHtml += `<button class="etf-tab${currentETF===etf?' active':''}" onclick="switchEtf('${etf}')">${etf} ${processedData[etf].name.split(" ")[0]}</button>`;
      });
      document.getElementById('etfTabs').innerHTML = tabHtml;
    }

    function switchEtf(etfCode) {
      currentETF = etfCode;
      renderTabs();
      renderEtfDetail(etfCode);
    }

    // è¼‰å…¥json
    document.addEventListener('DOMContentLoaded',()=>{
      fetch('./processed_etf_data.json').then(r=>r.json()).then(data=>{
        processedData = data;
        // æ—¥æœŸå€
        let latest = "";
        let first = processedData[Object.keys(processedData)[0]];
        if(first && first.latest_date){
          latest = "æœ€æ–°æ›´æ–°: " + first.latest_date;
          document.getElementById('updateTime').textContent = latest;
        }
        switchEtf(Object.keys(processedData)[0]);
      }).catch(e=>{
        document.getElementById('etfDetailArea').innerHTML = '<div style="color:red;">è³‡æ–™è¼‰å…¥éŒ¯èª¤ï¼Œè«‹ç¢ºèªæª”æ¡ˆï¼</div>';
      });
    });
  </script>
</body>
</html>
